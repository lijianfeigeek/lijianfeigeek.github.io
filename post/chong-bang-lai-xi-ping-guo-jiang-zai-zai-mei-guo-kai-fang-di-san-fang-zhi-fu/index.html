<html>
  <head>
    <meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>重磅来袭：苹果将在美国开放第三方支付 | lijianfei.com</title>
<link rel="shortcut icon" href="https://lijianfei.com/favicon.ico?v=1761120781074">
<link href="https://cdn.jsdelivr.net/npm/remixicon@2.3.0/fonts/remixicon.css" rel="stylesheet">
<link rel="stylesheet" href="https://lijianfei.com/styles/main.css">
<link rel="alternate" type="application/atom+xml" title="重磅来袭：苹果将在美国开放第三方支付 | lijianfei.com - Atom Feed" href="https://lijianfei.com/atom.xml">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Droid+Serif:400,700">
<script id="chatway" async="true" src="https://cdn.chatway.app/widget.js?id=laNLrbQJYsup"></script>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5152652314157130"
     crossorigin="anonymous">
</script>

<script type="text/javascript">
    (function(c,l,a,r,i,t,y){
        c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
        t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
        y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
    })(window, document, "clarity", "script", "m0j4678d23");
</script>
     


<script async src="https://www.googletagmanager.com/gtag/js?id=UA-74398720-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-74398720-1');
</script>


    <meta property="og:title" content="重磅来袭：苹果将在美国开放第三方支付">
    <meta property="og:description" content="美国最高法院就苹果和 Epic 的大战做出了重要裁决。


美国最高法院就苹果和 Epic 的大战做出了重要裁决，拒绝了苹果的上诉，坚持原来的判决。这意味着苹果必须允许开发者引导用户使用其他支付方式。👏
🍏 苹果公司今天更新了美国 Ap...">
    <meta property="og:type" content="SwiftUI,Objc,Swift,Xcode">
    <meta property="og:url" content="https://lijianfei.com/post/chong-bang-lai-xi-ping-guo-jiang-zai-zai-mei-guo-kai-fang-di-san-fang-zhi-fu/">
    <meta property="og:image" content="https://raw.githubusercontent.com/lijianfeigeek/PictureBed/main/uPic/2024-04-12-18-02-17.png"/>
    <meta property="og:image:width" content="800">
    <meta property="og:image:height" content="500">

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@lijianfei_com">
    <meta name="twitter:title" content="重磅来袭：苹果将在美国开放第三方支付">
    <meta name="twitter:image" content="https://raw.githubusercontent.com/lijianfeigeek/PictureBed/main/uPic/2024-04-12-18-02-17.png">
    <meta name="twitter:image:width" content="800">

    <meta name="description" content="美国最高法院就苹果和 Epic 的大战做出了重要裁决。


美国最高法院就苹果和 Epic 的大战做出了重要裁决，拒绝了苹果的上诉，坚持原来的判决。这意味着苹果必须允许开发者引导用户使用其他支付方式。👏
🍏 苹果公司今天更新了美国 Ap..." />
    <meta name="keywords" content="SwiftUI,Objc,Swift,Xcode" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
    <script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
  </head>
  <body>
    <div class="main">
      <div class="main-content">
        <div class="site-header">
  <a href="https://lijianfei.com">
  <img class="avatar" src="https://lijianfei.com/images/avatar.png?v=1761120781074" alt="">
  </a>
  <h1 class="site-title">
    lijianfei.com
  </h1>
  <p class="site-description">
    思危，思退，思变。<br>
追求进步，不求完美。<br>
做好小事，熬过难事，静成大事。<br>
语以泄败，事以密成，沉得住气，静得下心。
  </p>
  <div class="menu-container">
    
      
        <a href="/" class="menu">
          首页
        </a>
      
    
      
        <a href="/archives" class="menu">
          归档
        </a>
      
    
      
        <a href="/tags" class="menu">
          标签
        </a>
      
    
      
        <a href="/post/about" class="menu">
          关于我
        </a>
      
    
      
        <a href="https://github.com/lijianfeigeek" class="menu" target="_blank">
          Github
        </a>
      
    
  </div>
  <div class="social-container">
    
      
    
      
    
      
    
      
    
      
    
    <img src="https://ghchart.rshah.org/F15406/lijianfeigeek" style="max-width: 100%;height: auto;"/>
  </div>
</div>

        <div class="post-detail">
          <article class="post">
            <h2 class="post-title">
              重磅来袭：苹果将在美国开放第三方支付
            </h2>
            <div class="post-info">
              <span>
                2024-01-26
              </span>
              <span>
                6 min read
              </span>
              
                <a href="https://lijianfei.com/tag/swiftui/" class="post-tag">
                  # SwiftUI
                </a>
              
                <a href="https://lijianfei.com/tag/objc/" class="post-tag">
                  # Objc
                </a>
              
                <a href="https://lijianfei.com/tag/swift/" class="post-tag">
                  # Swift
                </a>
              
                <a href="https://lijianfei.com/tag/xcode/" class="post-tag">
                  # Xcode
                </a>
              
            </div>
            
              <img class="post-feature-image" src="https://raw.githubusercontent.com/lijianfeigeek/PictureBed/main/uPic/2024-04-12-18-02-17.png" alt="">
            
            <div class="post-content-wrapper">
              <div class="post-content">
                <p>美国最高法院就苹果和 Epic 的大战做出了重要裁决。</p>
<!-- more -->
<p><img src="https://raw.githubusercontent.com/lijianfeigeek/PictureBed/main/uPic/8Ll22x.png" alt="8Ll22x" loading="lazy"><br>
美国最高法院就苹果和 Epic 的大战做出了重要裁决，拒绝了苹果的上诉，坚持原来的判决。这意味着苹果必须允许开发者引导用户使用其他支付方式。👏</p>
<p>🍏 苹果公司今天更新了美国 App Store 的指南，现在开发者们可以在应用中加入链接，指向第三方支付方式了。这在以前是不可想象的，因为之前所有的虚拟商品购买都必须通过苹果的内购系统（IAP）。这一改变可谓是翻天覆地啊！🌟</p>
<p>来看看这意味着什么吧：如果你的应用在美国区上架，现在可以把内购商品的购买链接到网页上了，比如直接指向你们自己的官网。</p>
<h2 id="新的费用规则">新的费用规则</h2>
<p>🤑 而在收费方面，苹果还是要分一杯羹的。我们来比较一下抽成比例：</p>
<ul>
<li>如果通过苹果的内购（IAP）支付，苹果要收取高达 30% 的利润，不过对于小商家来说，这个比例会降到 15%。</li>
<li>如果通过第三方链接支付，苹果的抽成降到了 27%，而小商家的比例则是 12%。</li>
</ul>
<p>这个变化真是令人振奋，对开发者们来说无疑是个大好消息！🎉💻</p>
<p>🌟 这件事真是令人激动！想想看，苹果如何确保从第三方支付中分得一杯羹呢？毕竟一旦交易绕开了苹果的系统，要实现收入分成就变得相当棘手。不过，苹果已经有了应对策略：要求那些接入第三方支付链接的应用，每个月都要在15号之前，主动提交他们的流水账单给苹果。然后，苹果会根据这些账单向开发者收取相应的分成。📊</p>
<p>但这里有个问题：苹果怎么防止商家作假账呢？现在还没有确切的答案。不过，苹果表示他们“可能”会推出一些相关的API来确保这一点。这听起来就像是科技界的猫捉老鼠游戏，真是令人兴奋不已啊！期待苹果如何出招，保护自己的利益同时也保持公平竞争。🔍💡🎉</p>
<h2 id="代码规则">代码规则</h2>
<p>🌈 太棒了！对于开发者来说，这可是开启新篇章的大事。想知道怎么实现这个让人兴奋的新功能吗？跟我一起来看看这个精彩的过程吧！🚀</p>
<p>1️⃣ <strong>首先，填写申请表</strong> 📝<br>
就像开启一段奇妙旅程一样，你得先访问 <a href="https://developer.apple.com/contact/request/storekit-external-entitlement-us/">苹果开发者网站</a> 填写申请表。记住，只有开发者账户的主人才能填写哦！🔑 审核通过后，你会收到一封确认授权的邮件，然后就能迈向下一个兴奋的步骤了！</p>
<p><img src="https://raw.githubusercontent.com/lijianfeigeek/PictureBed/main/uPic/1xxvFd.png" alt="1xxvFd" loading="lazy"><br>
<img src="https://raw.githubusercontent.com/lijianfeigeek/PictureBed/main/uPic/7VF9HU.png" alt="7VF9HU" loading="lazy"></p>
<p>2️⃣ <strong>接着，配置Xcode项目</strong> 🛠️<br>
打开你的 Xcode，找到 <code>.entitlements</code> 文件，就像找到宝藏图一样，加入一个闪闪发光的新值：<code>com.apple.developer.storekit.external-purchase-link</code>，并把它的 value 设置为 True。这就像是向全世界（美国）宣布：“我的App支持外部购买链接！”🌍</p>
<figure data-type="image" tabindex="1"><img src="https://raw.githubusercontent.com/lijianfeigeek/PictureBed/main/uPic/QiVIkR.png" alt="QiVIkR" loading="lazy"></figure>
<pre><code>在 Xcode 中处理 `.entitlements` 文件的问题时，首先要了解 `.entitlements` 文件的作用。
这个文件用于定义应用程序的安全权限和功能，比如推送通知、iCloud 服务等。
如果你的新项目中没有 `.entitlements` 文件，可能是因为项目还没有需要这些特殊权限或功能。😊

要在 Xcode 中创建 `.entitlements` 文件，你可以按照以下步骤操作：

1. 打开你的项目。
2. 选择项目的 target。
3. 进入 &quot;Signing &amp; Capabilities&quot; 选项卡。
4. 点击 &quot;+ Capability&quot; 按钮，然后选择一个功能，如 &quot;Push Notifications&quot;。
5. Xcode 会自动为你的项目生成 `.entitlements` 文件，并添加相应的权限。

如果你需要手动创建 `.entitlements` 文件，可以：

1. 右击项目导航器中的任何组（group）。
2. 选择 &quot;New File&quot;。
3. 选择 &quot;Property List&quot;。
4. 命名文件（通常以 `.entitlements` 结尾），比如 `YourAppName.entitlements`。
5. 将文件添加到你的 target 中。

完成后，你就可以在 `.entitlements` 文件中配置所需的权限和功能了。👍
</code></pre>
<p>紧接着，在项目的 <code>info.plist</code> 文件中，添加一个神秘的新 Key：<code>SKExternalPurchaseLink</code>。这里需要一个字典，字典里再加个 key 叫 <code>us</code>，value 就是你的那个神奇链接。</p>
<figure data-type="image" tabindex="2"><img src="https://raw.githubusercontent.com/lijianfeigeek/PictureBed/main/uPic/SXuPI3.png" alt="SXuPI3" loading="lazy"></figure>
<p>🔮 这不仅仅是一个链接，它还预示着苹果可能为其他国家也开通这个功能的秘密计划哦！</p>
<p>然后，对于这个链接，苹果也有一些魔法规则：必须是安全的 https，不能有查询参数，而且要少于1000个字符。</p>
<p>3️⃣ <strong>最后，代码实现的魔法</strong> 🧙‍♂️<br>
当用户准备使用这个神奇的外部链接时，先调用 <code>canMakePayments()</code> 方法，确认一下是否可以支付。然后，调用外部购买链接 API，苹果会像魔术师一样，自动唤起一个新页面告诉用户他们要跳出App支付了。</p>
<p>用户点击继续后，系统就会像跳跃到新世界一样，带他们到 Safari 打开那个神秘的链接，完成购买。</p>
<figure data-type="image" tabindex="3"><img src="https://raw.githubusercontent.com/lijianfeigeek/PictureBed/main/uPic/tZGK3b.png" alt="tZGK3b" loading="lazy"></figure>
<p>这就是这次充满激动和惊喜的新功能实现之旅！开发者们，准备好迎接这个新时代了吗？🌟🎉💻</p>
<h2 id="最后">最后</h2>
<p>苹果虽然依旧在支付方面握着紧紧的控制权，但这次的改变，就像是开启了一扇大门！🚪 尽管想要完全绕开苹果的规定并不容易，苹果会设置各种障碍，但看啊，这个科技巨头也被大趋势所推动，不得不逐渐开放了！</p>
<p>这就像是苹果在一片森严的围墙中开了一个小窗户，虽然不大，但光线已经透进来了。🌞 这对苹果来说，无疑是个重大的让步，就像是在高墙上刻下了一个印记。</p>
<p>而且，别忘了那个 3 月的大决定，苹果必须开放侧载和第三方应用商店，这都是在相关法律法规的推动下发生的。这不仅仅是一个改变，这是一个时代的变迁！</p>
<p>我们有机会再来好好聊聊这块内容，毕竟这是一个既激动又引人深思的话题。期待着和你们分享更多，感受这个变化带来的波澜壮阔！🌊🚀💫</p>

              </div>
              <div class="toc-container">
                <ul class="markdownIt-TOC">
<li>
<ul>
<li><a href="#%E6%96%B0%E7%9A%84%E8%B4%B9%E7%94%A8%E8%A7%84%E5%88%99">新的费用规则</a></li>
<li><a href="#%E4%BB%A3%E7%A0%81%E8%A7%84%E5%88%99">代码规则</a></li>
<li><a href="#%E6%9C%80%E5%90%8E">最后</a></li>
</ul>
</li>
</ul>

              </div>
            </div>
          </article>
        </div>

        
          <div class="next-post">
            <div class="next">下一篇</div>
            <a href="https://lijianfei.com/post/zai-xcode-15-zhong-shi-yong-logger/">
              <h3 class="post-title">
                在 Xcode 15 中使用 Logger
              </h3>
            </a>
          </div>
        

        

        <div class="site-footer">
  Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a>
  <a class="rss" href="https://lijianfei.com/atom.xml" target="_blank">
    <i class="ri-rss-line"></i> RSS
  </a>
</div>

      </div>
    </div>

    <script>
      hljs.initHighlightingOnLoad()

      let mainNavLinks = document.querySelectorAll(".markdownIt-TOC a");

      // This should probably be throttled.
      // Especially because it triggers during smooth scrolling.
      // https://lodash.com/docs/4.17.10#throttle
      // You could do like...
      // window.addEventListener("scroll", () => {
      //    _.throttle(doThatStuff, 100);
      // });
      // Only not doing it here to keep this Pen dependency-free.

      window.addEventListener("scroll", event => {
        let fromTop = window.scrollY;

        mainNavLinks.forEach((link, index) => {
          let section = document.getElementById(decodeURI(link.hash).substring(1));
          let nextSection = null
          if (mainNavLinks[index + 1]) {
            nextSection = document.getElementById(decodeURI(mainNavLinks[index + 1].hash).substring(1));
          }
          if (section.offsetTop <= fromTop) {
            if (nextSection) {
              if (nextSection.offsetTop > fromTop) {
                link.classList.add("current");
              } else {
                link.classList.remove("current");    
              }
            } else {
              link.classList.add("current");
            }
          } else {
            link.classList.remove("current");
          }
        });
      });

    </script>
  </body>
</html>
