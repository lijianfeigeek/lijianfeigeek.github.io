<html>
  <head>
    <meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>震惊！只需7GB显存就能训练出DeepSeek R1级别推理模型？Unsloth带你轻松上手！ | lijianfei.com</title>
<link rel="shortcut icon" href="https://lijianfei.com/favicon.ico?v=1761120781074">
<link href="https://cdn.jsdelivr.net/npm/remixicon@2.3.0/fonts/remixicon.css" rel="stylesheet">
<link rel="stylesheet" href="https://lijianfei.com/styles/main.css">
<link rel="alternate" type="application/atom+xml" title="震惊！只需7GB显存就能训练出DeepSeek R1级别推理模型？Unsloth带你轻松上手！ | lijianfei.com - Atom Feed" href="https://lijianfei.com/atom.xml">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Droid+Serif:400,700">
<script id="chatway" async="true" src="https://cdn.chatway.app/widget.js?id=laNLrbQJYsup"></script>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5152652314157130"
     crossorigin="anonymous">
</script>

<script type="text/javascript">
    (function(c,l,a,r,i,t,y){
        c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
        t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
        y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
    })(window, document, "clarity", "script", "m0j4678d23");
</script>
     


<script async src="https://www.googletagmanager.com/gtag/js?id=UA-74398720-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-74398720-1');
</script>


    <meta property="og:title" content="震惊！只需7GB显存就能训练出DeepSeek R1级别推理模型？Unsloth带你轻松上手！">
    <meta property="og:description" content="大家好啊！今天我们要聊一个超级硬核但又无比有趣的话题：如何用开源工具Unsloth训练出一款像DeepSeek R1那样具备自主推理能力的模型！听起来是不是很酷炫？别急，咱们一步步来，保证你也能成为AI训练大师！

什么是Unsloth？
...">
    <meta property="og:type" content="DeepSeek,AI">
    <meta property="og:url" content="https://lijianfei.com/post/zhen-liang-zhi-xu-7gb-xian-cun-jiu-neng-xun-lian-chu-deepseek-r1-ji-bie-tui-li-mo-xing-unsloth-dai-ni-qing-song-shang-shou/">
    <meta property="og:image" content="https://cdn.jsdelivr.net/gh/lijianfeigeek/PictureBed@20241223/uPic/2MQlue.png"/>
    <meta property="og:image:width" content="800">
    <meta property="og:image:height" content="500">

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@lijianfei_com">
    <meta name="twitter:title" content="震惊！只需7GB显存就能训练出DeepSeek R1级别推理模型？Unsloth带你轻松上手！">
    <meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/lijianfeigeek/PictureBed@20241223/uPic/2MQlue.png">
    <meta name="twitter:image:width" content="800">

    <meta name="description" content="大家好啊！今天我们要聊一个超级硬核但又无比有趣的话题：如何用开源工具Unsloth训练出一款像DeepSeek R1那样具备自主推理能力的模型！听起来是不是很酷炫？别急，咱们一步步来，保证你也能成为AI训练大师！

什么是Unsloth？
..." />
    <meta name="keywords" content="DeepSeek,AI" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
    <script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
  </head>
  <body>
    <div class="main">
      <div class="main-content">
        <div class="site-header">
  <a href="https://lijianfei.com">
  <img class="avatar" src="https://lijianfei.com/images/avatar.png?v=1761120781074" alt="">
  </a>
  <h1 class="site-title">
    lijianfei.com
  </h1>
  <p class="site-description">
    思危，思退，思变。<br>
追求进步，不求完美。<br>
做好小事，熬过难事，静成大事。<br>
语以泄败，事以密成，沉得住气，静得下心。
  </p>
  <div class="menu-container">
    
      
        <a href="/" class="menu">
          首页
        </a>
      
    
      
        <a href="/archives" class="menu">
          归档
        </a>
      
    
      
        <a href="/tags" class="menu">
          标签
        </a>
      
    
      
        <a href="/post/about" class="menu">
          关于我
        </a>
      
    
      
        <a href="https://github.com/lijianfeigeek" class="menu" target="_blank">
          Github
        </a>
      
    
  </div>
  <div class="social-container">
    
      
    
      
    
      
    
      
    
      
    
    <img src="https://ghchart.rshah.org/F15406/lijianfeigeek" style="max-width: 100%;height: auto;"/>
  </div>
</div>

        <div class="post-detail">
          <article class="post">
            <h2 class="post-title">
              震惊！只需7GB显存就能训练出DeepSeek R1级别推理模型？Unsloth带你轻松上手！
            </h2>
            <div class="post-info">
              <span>
                2025-02-09
              </span>
              <span>
                8 min read
              </span>
              
                <a href="https://lijianfei.com/tag/DeepSeek/" class="post-tag">
                  # DeepSeek
                </a>
              
                <a href="https://lijianfei.com/tag/ai/" class="post-tag">
                  # AI
                </a>
              
            </div>
            
              <img class="post-feature-image" src="https://cdn.jsdelivr.net/gh/lijianfeigeek/PictureBed@20241223/uPic/2MQlue.png" alt="">
            
            <div class="post-content-wrapper">
              <div class="post-content">
                <p>大家好啊！今天我们要聊一个超级硬核但又无比有趣的话题：如何用开源工具Unsloth训练出一款像DeepSeek R1那样具备自主推理能力的模型！听起来是不是很酷炫？别急，咱们一步步来，保证你也能成为AI训练大师！</p>
<!-- more -->
<h2 id="什么是unsloth">什么是Unsloth？</h2>
<p>首先，咱们得了解一下Unsloth这个神奇的存在。Unsloth是一个开源的大模型训练与微调工具包，简单来说就是一款让你轻松上手训练大模型的“瑞士军刀”。它兼容Hugging Face生态系统，并支持大多数Nvidia GPU，这意味着无论是新手还是老司机都能用它来搞事情！</p>
<p>更牛的是，Unsloth整合了TRL库中的各种训练套件，比如SFT（ Supervised Fine-Tuning）、DPO（Deep Policy Optimization）、PPO（Proximal Policy Optimization）等等。而今天我们要重点介绍的则是GRPO（Generalized Reward Policy Optimization），这是由DeepSeek团队提出的全新算法，堪称模型训练界的“黑科技”！</p>
<h2 id="grpo让模型自己学会思考">GRPO：让模型自己学会思考</h2>
<p>提到GRPO，就得夸一夸它的厉害之处！GRPO的核心思想是让模型能够自主学习，并分配更多的思考时间，整个过程完全不需要人类干预。这意味着即使你手头只有输入输出数据（比如问题和答案），而没有中间的推理过程，GRPO也能帮你自动生成合理的推理链。</p>
<p>这在法律、医疗等需要严谨推理的专业领域简直是神器！毕竟，谁不想拥有一款能自己思考、自己解决问题的AI呢？</p>
<h2 id="为什么选择unsloth训练r1模型">为什么选择Unsloth训练R1模型？</h2>
<p>说了这么多，你可能会问：为什么要用Unsloth来训练R1模型？答案很简单——因为它就是为这个而生的！</p>
<p>Unsloth最新发布的博客中详细介绍了如何基于它来实现R1推理模型的训练。通过优化GRPO训练过程，团队成功地将显存占用率降低了80%！这意味着你只需要7GB的显存就能训练出具有自主推理能力的模型！这简直是GPU界的减肥奇迹！</p>
<p>如果你有一块15GB显存的GPU，那更是如虎添翼！你可以将任何参数量在15 billion以下的模型（比如Llama 3.18B）轻松转换为具备推理能力的模型。这下不用再担心硬件不够用了，兄弟们！</p>
<h2 id="实战用unsloth训练自己的r1模型">实战：用Unsloth训练自己的R1模型</h2>
<p>好了，理论知识咱们都聊完了，现在是时候上手实战了！咱们以官方提供的Python Notebook为例，一步步教你如何用Unsloth训练出属于自己的R1推理模型。</p>
<h3 id="第一步准备环境">第一步：准备环境</h3>
<p>首先，你需要在Colab上连接到T4类型的运行环境（这是Unsloth推荐的配置）。接下来安装一系列依赖包，包括Unsloth、vLLM、Pillow等等。别担心，官方已经为大家准备好了详细的代码，咱们只需要跟着跑就行。</p>
<h3 id="第二步导入核心组件">第二步：导入核心组件</h3>
<p>安装完环境后，我们需要导入Unsloth的核心组件并初始化。这一步主要是加载模型和配置一些训练参数，比如最大序列长度（Max sequence length）和Lora rank值（这个值越大，模型越智能，但训练速度会变慢哦！）</p>
<h3 id="第三步加载基座模型">第三步：加载基座模型</h3>
<p>接下来就是加载咱们的基座模型了！在这个示例中，咱们使用的是Llama 3.18B instruct模型。为了节省内存，咱们会对模型进行4位量化处理，并启用vLLM快速推理功能。</p>
<p>这里还有一个小细节——GPU显存利用率设置为60%。这意味着咱们会预留一部分显存空间，防止训练过程中出现显存溢出问题。这个设定非常贴心，尤其适合新手朋友！</p>
<h3 id="第四步配置peft">第四步：配置PEFT</h3>
<p>PEFT（Parameter-Efficient Fine-Tuning）是高效参数微调的简称，目的是让模型在资源有限的情况下也能实现高效的微调。咱们在这里使用Lora方法对模型进行PEFT配置。</p>
<p>Lora rank值咱们设置为32，这个值既保证了模型的智能性，又不会让训练速度变得太慢。当然，你也可以根据自己的硬件条件和需求调整这个值哦！</p>
<h3 id="第五步准备数据集">第五步：准备数据集</h3>
<p>数据是训练的基础！在这个示例中，咱们使用的是OpenAI提供的GSM 8K数据集（你可以通过Hugging Face直接获取）。这是一个非常简单的数据集，只包含问题和答案两列。</p>
<p>由于咱们用的是GRPO算法，即使数据集中没有中间的推理链，模型也能自动生成合理的思考过程。这在实际应用中非常有用，尤其是在法律、医疗等需要严谨推理的专业领域！</p>
<h3 id="第六步定义奖励函数">第六步：定义奖励函数</h3>
<p>为了训练出一款优秀的推理模型，咱们还需要定义一系列奖励函数。这些函数的作用是评估模型输出的质量，并给予相应的奖励。</p>
<p>具体来说，咱们定义了以下几类奖励函数：</p>
<ol>
<li><strong>正确性奖励</strong>：评估模型输出的答案是否正确。</li>
<li><strong>格式奖励（松散）</strong>：检查模型输出的XML格式是否符合要求（松散模式）。</li>
<li><strong>格式奖励（严格）</strong>：同样用于检查XML格式，但采用严格的验证标准。</li>
<li><strong>标签完整性奖励</strong>：确保模型生成的XML标签完整且正确。</li>
</ol>
<p>这些奖励函数将帮助咱们训练出一款既准确又规范的推理模型！</p>
<h3 id="第七步创建grpo配置对象">第七步：创建GRPO配置对象</h3>
<p>现在咱们需要创建一个GRPO配置对象，并设置一些关键参数，比如优化器类型（8位优化器）、学习率调度策略、梯度裁剪等等。</p>
<p>这里有几个需要注意的地方：</p>
<ul>
<li><strong>Warm-up ratio</strong>：指定预热阶段占总训练步骤的比例。咱们设置为10%，也就是说前10%的步骤将用于预热。</li>
<li><strong>LR scheduler type</strong>：采用余弦学习率调度策略，这样可以更好地控制学习率的变化趋势。</li>
<li><strong>Optimizer</strong>：使用8位优化器，这有助于降低显存占用并加速训练过程。</li>
</ul>
<h3 id="第八步开始训练">第八步：开始训练</h3>
<p>万事俱备，只欠东风！现在咱们可以正式启动模型的训练了！</p>
<p>需要注意的是，GRPO算法的学习曲线可能会比较平缓。根据官方博客的介绍，在至少300步以后才会逐渐看到奖励值的增加。而要获得一个比较好的结果，则需要训练至少12个小时。</p>
<p>不过，这也并非绝对！咱们可以在任何时候暂停训练，并根据当前的状态决定是否继续优化模型。这种灵活性让训练过程更加高效！</p>
<h3 id="第九步推理测试与保存模型">第九步：推理测试与保存模型</h3>
<p>经过漫长的等待后，终于到了检验成果的时候了！咱们可以通过以下代码段对训练好的模型进行推理测试：</p>
<pre><code class="language-python"># 推理测试参数配置
temperature = 0.8
top_p = 0.95
max_tokens = 1024

# 执行推理
output = model.fast_generate(
    prompt,
    temperature=temperature,
    top_p=top_p,
    max_tokens=max_tokens
)
</code></pre>
<p>如果你对模型的表现感到满意，那么就可以将它保存下来啦！咱们可以通过<code>model.save_lora()</code>函数保存Lora权重数据。这些参数包括了模型在训练过程中学到的矩阵权重更新，并不会保存整个基础模型。</p>
<p>保存完成后，你还可以根据需要选择不同的格式（比如16位或4位）进行存储，以适应不同设备的需求。最后别忘了将你的模型推送到Hugging Face，与全世界的AI爱好者分享你的成果！</p>
<h2 id="总结从零到一轻松上手">总结：从零到一，轻松上手</h2>
<p>通过本文的内容，咱们一起了解了如何用Unsloth训练出一款像DeepSeek R1那样具备自主推理能力的大模型。整个过程虽然看似复杂，但只要按照官方提供的Python Notebook一步步来，其实并不难。</p>
<p>特别值得一提的是GRPO算法的内存优化效果，显存占用率降低了80%，这意味着即使是普通玩家也能轻松上手！如果你对AI训练感兴趣，不妨立即行动起来，用Unsloth打造属于自己的智能模型吧！</p>

              </div>
              <div class="toc-container">
                <ul class="markdownIt-TOC">
<li>
<ul>
<li><a href="#%E4%BB%80%E4%B9%88%E6%98%AFunsloth">什么是Unsloth？</a></li>
<li><a href="#grpo%E8%AE%A9%E6%A8%A1%E5%9E%8B%E8%87%AA%E5%B7%B1%E5%AD%A6%E4%BC%9A%E6%80%9D%E8%80%83">GRPO：让模型自己学会思考</a></li>
<li><a href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E9%80%89%E6%8B%A9unsloth%E8%AE%AD%E7%BB%83r1%E6%A8%A1%E5%9E%8B">为什么选择Unsloth训练R1模型？</a></li>
<li><a href="#%E5%AE%9E%E6%88%98%E7%94%A8unsloth%E8%AE%AD%E7%BB%83%E8%87%AA%E5%B7%B1%E7%9A%84r1%E6%A8%A1%E5%9E%8B">实战：用Unsloth训练自己的R1模型</a>
<ul>
<li><a href="#%E7%AC%AC%E4%B8%80%E6%AD%A5%E5%87%86%E5%A4%87%E7%8E%AF%E5%A2%83">第一步：准备环境</a></li>
<li><a href="#%E7%AC%AC%E4%BA%8C%E6%AD%A5%E5%AF%BC%E5%85%A5%E6%A0%B8%E5%BF%83%E7%BB%84%E4%BB%B6">第二步：导入核心组件</a></li>
<li><a href="#%E7%AC%AC%E4%B8%89%E6%AD%A5%E5%8A%A0%E8%BD%BD%E5%9F%BA%E5%BA%A7%E6%A8%A1%E5%9E%8B">第三步：加载基座模型</a></li>
<li><a href="#%E7%AC%AC%E5%9B%9B%E6%AD%A5%E9%85%8D%E7%BD%AEpeft">第四步：配置PEFT</a></li>
<li><a href="#%E7%AC%AC%E4%BA%94%E6%AD%A5%E5%87%86%E5%A4%87%E6%95%B0%E6%8D%AE%E9%9B%86">第五步：准备数据集</a></li>
<li><a href="#%E7%AC%AC%E5%85%AD%E6%AD%A5%E5%AE%9A%E4%B9%89%E5%A5%96%E5%8A%B1%E5%87%BD%E6%95%B0">第六步：定义奖励函数</a></li>
<li><a href="#%E7%AC%AC%E4%B8%83%E6%AD%A5%E5%88%9B%E5%BB%BAgrpo%E9%85%8D%E7%BD%AE%E5%AF%B9%E8%B1%A1">第七步：创建GRPO配置对象</a></li>
<li><a href="#%E7%AC%AC%E5%85%AB%E6%AD%A5%E5%BC%80%E5%A7%8B%E8%AE%AD%E7%BB%83">第八步：开始训练</a></li>
<li><a href="#%E7%AC%AC%E4%B9%9D%E6%AD%A5%E6%8E%A8%E7%90%86%E6%B5%8B%E8%AF%95%E4%B8%8E%E4%BF%9D%E5%AD%98%E6%A8%A1%E5%9E%8B">第九步：推理测试与保存模型</a></li>
</ul>
</li>
<li><a href="#%E6%80%BB%E7%BB%93%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E8%BD%BB%E6%9D%BE%E4%B8%8A%E6%89%8B">总结：从零到一，轻松上手</a></li>
</ul>
</li>
</ul>

              </div>
            </div>
          </article>
        </div>

        
          <div class="next-post">
            <div class="next">下一篇</div>
            <a href="https://lijianfei.com/post/deepseek-r1-671b-man-xie-ai-de-xun-fu-ji-wo-zai-ben-di-yu-yun-duan-de-ji-xian-tiao-zhan/">
              <h3 class="post-title">
                蚊子抗高射炮？揭秘如何在低配电脑上运行 DeepSeek R1 671B大模型！
              </h3>
            </a>
          </div>
        

        

        <div class="site-footer">
  Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a>
  <a class="rss" href="https://lijianfei.com/atom.xml" target="_blank">
    <i class="ri-rss-line"></i> RSS
  </a>
</div>

      </div>
    </div>

    <script>
      hljs.initHighlightingOnLoad()

      let mainNavLinks = document.querySelectorAll(".markdownIt-TOC a");

      // This should probably be throttled.
      // Especially because it triggers during smooth scrolling.
      // https://lodash.com/docs/4.17.10#throttle
      // You could do like...
      // window.addEventListener("scroll", () => {
      //    _.throttle(doThatStuff, 100);
      // });
      // Only not doing it here to keep this Pen dependency-free.

      window.addEventListener("scroll", event => {
        let fromTop = window.scrollY;

        mainNavLinks.forEach((link, index) => {
          let section = document.getElementById(decodeURI(link.hash).substring(1));
          let nextSection = null
          if (mainNavLinks[index + 1]) {
            nextSection = document.getElementById(decodeURI(mainNavLinks[index + 1].hash).substring(1));
          }
          if (section.offsetTop <= fromTop) {
            if (nextSection) {
              if (nextSection.offsetTop > fromTop) {
                link.classList.add("current");
              } else {
                link.classList.remove("current");    
              }
            } else {
              link.classList.add("current");
            }
          } else {
            link.classList.remove("current");
          }
        });
      });

    </script>
  </body>
</html>
