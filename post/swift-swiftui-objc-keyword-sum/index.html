<html>
  <head>
    <meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>SwiftUI/Swift/Objective-Cä¿®é¥°ç¬¦æ€»ç»“ | lijianfei.com</title>
<link rel="shortcut icon" href="https://lijianfei.com/favicon.ico?v=1761120781074">
<link href="https://cdn.jsdelivr.net/npm/remixicon@2.3.0/fonts/remixicon.css" rel="stylesheet">
<link rel="stylesheet" href="https://lijianfei.com/styles/main.css">
<link rel="alternate" type="application/atom+xml" title="SwiftUI/Swift/Objective-Cä¿®é¥°ç¬¦æ€»ç»“ | lijianfei.com - Atom Feed" href="https://lijianfei.com/atom.xml">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Droid+Serif:400,700">
<script id="chatway" async="true" src="https://cdn.chatway.app/widget.js?id=laNLrbQJYsup"></script>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5152652314157130"
     crossorigin="anonymous">
</script>

<script type="text/javascript">
    (function(c,l,a,r,i,t,y){
        c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
        t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
        y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
    })(window, document, "clarity", "script", "m0j4678d23");
</script>
     


<script async src="https://www.googletagmanager.com/gtag/js?id=UA-74398720-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-74398720-1');
</script>


    <meta property="og:title" content="SwiftUI/Swift/Objective-Cä¿®é¥°ç¬¦æ€»ç»“">
    <meta property="og:description" content="SwiftUI
@State
ä¿®é¥°çš„å˜é‡æ˜¯å€¼ä¼ é€’çš„ï¼Œæ‰€ä»¥ä½œç”¨èŒƒå›´åœ¨å½“å‰è§†å›¾ï¼Œå˜é‡å€¼å˜åŒ–åä¼šè§¦å‘ç›¸å…³çš„Viewåˆ·æ–°ã€‚
@Binding
ä¿®é¥°çš„å˜é‡ä¼šå˜æˆå¼•ç”¨çš„å½¢å¼ä¼ é€’ï¼Œä¿è¯æŒæœ‰çš„å€¼æ˜¯ä¸€è‡´çš„ã€‚
@ObservedObject
å’ŒStateä½œç”¨ç±»...">
    <meta property="og:type" content="Objc,Swift">
    <meta property="og:url" content="https://lijianfei.com/post/swift-swiftui-objc-keyword-sum/">
    <meta property="og:image" content=""/>
    <meta property="og:image:width" content="800">
    <meta property="og:image:height" content="500">

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@lijianfei_com">
    <meta name="twitter:title" content="SwiftUI/Swift/Objective-Cä¿®é¥°ç¬¦æ€»ç»“">
    <meta name="twitter:image" content="">
    <meta name="twitter:image:width" content="800">

    <meta name="description" content="SwiftUI
@State
ä¿®é¥°çš„å˜é‡æ˜¯å€¼ä¼ é€’çš„ï¼Œæ‰€ä»¥ä½œç”¨èŒƒå›´åœ¨å½“å‰è§†å›¾ï¼Œå˜é‡å€¼å˜åŒ–åä¼šè§¦å‘ç›¸å…³çš„Viewåˆ·æ–°ã€‚
@Binding
ä¿®é¥°çš„å˜é‡ä¼šå˜æˆå¼•ç”¨çš„å½¢å¼ä¼ é€’ï¼Œä¿è¯æŒæœ‰çš„å€¼æ˜¯ä¸€è‡´çš„ã€‚
@ObservedObject
å’ŒStateä½œç”¨ç±»..." />
    <meta name="keywords" content="Objc,Swift" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
    <script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
  </head>
  <body>
    <div class="main">
      <div class="main-content">
        <div class="site-header">
  <a href="https://lijianfei.com">
  <img class="avatar" src="https://lijianfei.com/images/avatar.png?v=1761120781074" alt="">
  </a>
  <h1 class="site-title">
    lijianfei.com
  </h1>
  <p class="site-description">
    æ€å±ï¼Œæ€é€€ï¼Œæ€å˜ã€‚<br>
è¿½æ±‚è¿›æ­¥ï¼Œä¸æ±‚å®Œç¾ã€‚<br>
åšå¥½å°äº‹ï¼Œç†¬è¿‡éš¾äº‹ï¼Œé™æˆå¤§äº‹ã€‚<br>
è¯­ä»¥æ³„è´¥ï¼Œäº‹ä»¥å¯†æˆï¼Œæ²‰å¾—ä½æ°”ï¼Œé™å¾—ä¸‹å¿ƒã€‚
  </p>
  <div class="menu-container">
    
      
        <a href="/" class="menu">
          é¦–é¡µ
        </a>
      
    
      
        <a href="/archives" class="menu">
          å½’æ¡£
        </a>
      
    
      
        <a href="/tags" class="menu">
          æ ‡ç­¾
        </a>
      
    
      
        <a href="/post/about" class="menu">
          å…³äºæˆ‘
        </a>
      
    
      
        <a href="https://github.com/lijianfeigeek" class="menu" target="_blank">
          Github
        </a>
      
    
  </div>
  <div class="social-container">
    
      
    
      
    
      
    
      
    
      
    
    <img src="https://ghchart.rshah.org/F15406/lijianfeigeek" style="max-width: 100%;height: auto;"/>
  </div>
</div>

        <div class="post-detail">
          <article class="post">
            <h2 class="post-title">
              SwiftUI/Swift/Objective-Cä¿®é¥°ç¬¦æ€»ç»“
            </h2>
            <div class="post-info">
              <span>
                2022-09-11
              </span>
              <span>
                19 min read
              </span>
              
                <a href="https://lijianfei.com/tag/objc/" class="post-tag">
                  # Objc
                </a>
              
                <a href="https://lijianfei.com/tag/swift/" class="post-tag">
                  # Swift
                </a>
              
            </div>
            
            <div class="post-content-wrapper">
              <div class="post-content">
                <h2 id="swiftui">SwiftUI</h2>
<h3 id="state">@State</h3>
<p>ä¿®é¥°çš„å˜é‡æ˜¯å€¼ä¼ é€’çš„ï¼Œæ‰€ä»¥ä½œç”¨èŒƒå›´åœ¨å½“å‰è§†å›¾ï¼Œå˜é‡å€¼å˜åŒ–åä¼šè§¦å‘ç›¸å…³çš„Viewåˆ·æ–°ã€‚</p>
<h3 id="binding">@Binding</h3>
<p>ä¿®é¥°çš„å˜é‡ä¼šå˜æˆå¼•ç”¨çš„å½¢å¼ä¼ é€’ï¼Œä¿è¯æŒæœ‰çš„å€¼æ˜¯ä¸€è‡´çš„ã€‚</p>
<h3 id="observedobject">@ObservedObject</h3>
<p>å’ŒStateä½œç”¨ç±»ä¼¼ï¼Œå¯¹äºå˜é‡åªæ˜¯å¼•ç”¨ï¼Œä¸”å¯¹è±¡æ‰€å±çš„ç±»è¦éµä»ObservableObjectåè®®ï¼Œè¦ç›‘è§†çš„å±æ€§ç”¨@Publishedä¿®é¥°ã€‚<br>
å…¶ç”Ÿå‘½å‘¨æœŸä¸ç”±åˆ›å»ºå®ƒçš„Viewæ‰€æŒæœ‰ï¼Œéœ€è¦å¼€å‘è€…è‡ªè¡Œç®¡ç†ã€‚</p>
<h3 id="stateobject">@StateObject</h3>
<p>ä¸ObservedObjectçš„åŒºåˆ«æ˜¯ç”Ÿå‘½å‘¨æœŸç”±åˆ›å»ºå®ƒçš„Viewæ‰€æŒæœ‰ï¼Œæ— éœ€å¼€å‘è€…æ‰‹åŠ¨ç®¡ç†ã€‚</p>
<h3 id="environmentobject">@EnvironmentObject</h3>
<p>å¯¹æ‰€æœ‰Viewå¯è§ï¼Œå› æ­¤å˜é‡å¯ä»¥åœ¨ä»»æ„Viewä¹‹é—´ä¼ é€’ï¼Œè°ƒç”¨æ ¹è§†å›¾çš„environmentObject()æ–¹æ³•ä¼ é€’å˜é‡ï¼Œä»¥ä¾¿æ‰€æœ‰çš„å­è§†å›¾å¯ä»¥è®¿é—®å®ƒã€‚å…¶æ‰€å±çš„ç±»åŒæ ·è¦éµä»ObservableObjectåè®®ã€‚</p>
<h3 id="environment">@Environment</h3>
<p>è¯»å†™ç¯å¢ƒå˜é‡ï¼Œå†…ç½®äº†ç³»ç»Ÿçš„ä¸€äº›å…¬å…±å˜é‡ï¼Œä¹Ÿå¯ä»¥è‡ªå®šä¹‰ã€‚</p>
<h3 id="appstorage">@AppStorage</h3>
<p>@AppStorage æ˜¯ SwiftUI æ¡†æ¶æä¾›çš„ä¸€ä¸ªå±æ€§åŒ…è£…å™¨ï¼Œè®¾è®¡åˆè¡·æ˜¯åˆ›å»ºä¸€ç§åœ¨è§†å›¾ä¸­ä¿å­˜å’Œè¯»å– UserDefaults å˜é‡çš„å¿«æ·æ–¹æ³•ã€‚@AppStorage åœ¨è§†å›¾ä¸­çš„è¡Œä¸ºåŒ@State å¾ˆç±»ä¼¼ï¼Œå…¶å€¼å˜åŒ–æ—¶å°†å¯¼è‡´ä¸å…¶ä¾èµ–çš„è§†å›¾æ— æ•ˆå¹¶è¿›è¡Œé‡æ–°ç»˜åˆ¶ã€‚<br>
@AppStorage å£°æ˜æ—¶éœ€è¦æŒ‡å®šåœ¨ UserDefaults ä¸­ä¿å­˜çš„é”®åç§°ï¼ˆKeyï¼‰ä»¥åŠé»˜è®¤å€¼ã€‚</p>
<pre><code>@AppStorage(&quot;username&quot;) var name = &quot;lijianfei.com&quot;
</code></pre>
<p>userNameä¸ºé”®åç§°ï¼Œfatbobmanæ˜¯ä¸ºusernameè®¾å®šçš„é»˜è®¤å€¼ï¼Œå¦‚æœ UserDefaults ä¸­çš„usernameå·²ç»æœ‰å€¼ï¼Œåˆ™ä½¿ç”¨ä¿å­˜å€¼ã€‚</p>
<p>å¦‚æœä¸è®¾ç½®é»˜è®¤å€¼ï¼Œåˆ™å˜é‡çš„ä¸ºå¯é€‰å€¼ç±»å‹ã€‚</p>
<pre><code>@AppStorage(&quot;username&quot;) var name:String?
</code></pre>
<p>é»˜è®¤æƒ…å†µä¸‹ä½¿ç”¨çš„æ˜¯ UserDefaults.standardï¼Œä¹Ÿå¯ä»¥æŒ‡å®šå…¶ä»–çš„ UserDefaultsã€‚</p>
<pre><code>public extension UserDefaults {
    static let shared = UserDefaults(suiteName: &quot;group.com.lijianfei.examples&quot;)!
}

@AppStorage(&quot;userName&quot;,store:UserDefaults.shared) var name = &quot;lijianfei&quot;
</code></pre>
<p>å¯¹ UserDefaults æ“ä½œå°†ç›´æ¥å½±å“å¯¹åº”çš„@AppStorage</p>
<pre><code>UserDefaults.standard.set(&quot;bob&quot;,forKey:&quot;username&quot;)
</code></pre>
<p>ä¸Šè¿°ä»£ç å°†æ›´æ–°æ‰€æœ‰ä¾èµ–@AppStorage(&quot;username&quot;)çš„è§†å›¾ã€‚<br>
æ›´å¤šå‚è€ƒï¼š<a href="https://www.fatbobman.com/posts/appstorage/">@AppStorage ç ”ç©¶ | è‚˜å­çš„Swiftè®°äº‹æœ¬</a></p>
<h2 id="objc">Objc</h2>
<h2 id="swift">Swift</h2>
<h3 id="dynamicmemberlookup">@dynamicMemberLookup</h3>
<p>è¿™ä¸ªç‰¹æ€§ä¸­æ–‡å¯ä»¥å«åŠ¨æ€æŸ¥æ‰¾æˆå‘˜ã€‚åœ¨ä½¿ç”¨@dynamicMemberLookupæ ‡è®°äº†å¯¹è±¡åï¼ˆå¯¹è±¡ã€ç»“æ„ä½“ã€æšä¸¾ã€protocolï¼‰ï¼Œå®ç°äº†subscript(dynamicMember member: String)æ–¹æ³•åæˆ‘ä»¬å°±å¯ä»¥è®¿é—®åˆ°å¯¹è±¡ä¸å­˜åœ¨çš„å±æ€§ã€‚å¦‚æœè®¿é—®åˆ°çš„å±æ€§ä¸å­˜åœ¨ï¼Œå°±ä¼šè°ƒç”¨åˆ°å®ç°çš„ subscript(dynamicMember member: String)æ–¹æ³•ï¼Œkey ä½œä¸º member ä¼ å…¥è¿™ä¸ªæ–¹æ³•ã€‚<br>
æ¯”å¦‚æˆ‘ä»¬å£°æ˜äº†ä¸€ä¸ªç»“æ„ä½“ï¼Œæ²¡æœ‰å£°æ˜å±æ€§ã€‚</p>
<pre><code>@dynamicMemberLookup
struct Person {
    subscript(dynamicMember member: String) -&gt; String {
        let properties = [&quot;nickname&quot;: &quot;Jeffery&quot;, &quot;city&quot;: &quot;Singapore&quot;]
        return properties[member, default: &quot;undefined&quot;]
    }
}

//æ‰§è¡Œä»¥ä¸‹ä»£ç 
let p = Person()
print(p.city)
print(p.nickname)
print(p.name)
</code></pre>
<p>å¦‚æœæ²¡æœ‰å£°æ˜@dynamicMemberLookupçš„è¯ï¼Œæ‰§è¡Œçš„ä»£ç è‚¯å®šä¼šç¼–è¯‘å¤±è´¥ã€‚å¾ˆæ˜¾ç„¶ä½œä¸ºä¸€é—¨ç±»å‹å®‰å…¨è¯­è¨€ï¼Œç¼–è¯‘å™¨ä¼šå‘Šè¯‰ä½ ä¸å­˜åœ¨è¿™äº›å±æ€§ã€‚ä½†æ˜¯åœ¨å£°æ˜äº†@dynamicMemberLookupåï¼Œè™½ç„¶æ²¡æœ‰å®šä¹‰ cityç­‰å±æ€§ï¼Œä½†æ˜¯ç¨‹åºä¼šåœ¨è¿è¡Œæ—¶åŠ¨æ€çš„æŸ¥æ‰¾å±æ€§çš„å€¼ï¼Œè°ƒç”¨subscript(dynamicMember member: String)æ–¹æ³•æ¥è·å–å€¼ã€‚<br>
<img src="https://raw.githubusercontent.com/lijianfeigeek/PictureBed/main/uPic/yz37DN.png" alt="yz37DN" loading="lazy"></p>
<p>è€Œä¸”éªšçš„å¾ˆï¼Œè¿™ä¸œè¥¿è¿˜å¯ä»¥ç»§æ‰¿ã€‚</p>
<h3 id="available">@available</h3>
<p>@availableï¼š å¯ç”¨æ¥æ ‡è¯†è®¡ç®—å±æ€§ã€å‡½æ•°ã€ç±»ã€åè®®ã€ç»“æ„ä½“ã€æšä¸¾ç­‰ç±»å‹çš„ç”Ÿå‘½å‘¨æœŸã€‚ï¼ˆä¾èµ–äºç‰¹å®šçš„å¹³å°ç‰ˆæœ¬ æˆ– Swift ç‰ˆæœ¬ï¼‰ã€‚å®ƒçš„åé¢ä¸€èˆ¬è·Ÿè‡³å°‘ä¸¤ä¸ªå‚æ•°ï¼Œå‚æ•°ä¹‹é—´ä»¥é€—å·éš”å¼€ã€‚å…¶ä¸­ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å›ºå®šçš„ï¼Œä»£è¡¨ç€å¹³å°å’Œè¯­è¨€ï¼Œå¯é€‰å€¼æœ‰ä»¥ä¸‹è¿™å‡ ä¸ªï¼š</p>
<p>iOS<br>
iOSApplicationExtension<br>
macOS<br>
macOSApplicationExtension<br>
watchOS<br>
watchOSApplicationExtension<br>
tvOS<br>
tvOSApplicationExtension<br>
swift</p>
<p>å¯ä»¥ä½¿ç”¨*æŒ‡ä»£æ”¯æŒæ‰€æœ‰è¿™äº›å¹³å°ã€‚<br>
æœ‰ä¸€ä¸ªæˆ‘ä»¬å¸¸ç”¨çš„ä¾‹å­ï¼Œå½“éœ€è¦å…³é—­ScrollViewçš„è‡ªåŠ¨è°ƒæ•´insetåŠŸèƒ½æ—¶ï¼š</p>
<pre><code>if #available(iOS 11.0, *) {

  scrollView.contentInsetAdjustmentBehavior = .never

} else {

  automaticallyAdjustsScrollViewInsets = false

}
</code></pre>
<p>è¿˜æœ‰ä¸€ç§ç”¨æ³•æ˜¯æ”¾åœ¨å‡½æ•°ã€ç»“æ„ä½“ã€æšä¸¾ã€ç±»æˆ–è€…åè®®çš„å‰é¢ï¼Œè¡¨ç¤ºå½“å‰ç±»å‹ä»…é€‚ç”¨äºæŸä¸€å¹³å°ï¼š</p>
<pre><code>@available(iOS 12.0, *)
func adjustDarkMode() {
  /* code */
}
@available(iOS 12.0, *)
struct DarkModeConfig {
  /* code */
}
@available(iOS 12.0, *)
protocol DarkModeTheme {
  /* code */
}
</code></pre>
<p>ç‰ˆæœ¬å’Œå¹³å°çš„é™å®šå¯ä»¥å†™å¤šä¸ªï¼š</p>
<pre><code>@available(OSX 10.15, iOS 13, tvOS 13, watchOS 6, *)
public func applying(_ difference: CollectionDifference&lt;Element&gt;) -&gt; ArraySlice&lt;Element&gt;?
</code></pre>
<p>æ³¨æ„ï¼šä½œä¸ºæ¡ä»¶è¯­å¥çš„availableå‰é¢æ˜¯#ï¼Œä½œä¸ºæ ‡è®°ä½æ—¶æ˜¯@<br>
åˆšæ‰è¯´äº†ï¼Œavailableåé¢å‚æ•°è‡³å°‘è¦æœ‰ä¸¤ä¸ªï¼Œåé¢çš„å¯é€‰å‚æ•°è¿™äº›ï¼š</p>
<p>deprecatedï¼šä»æŒ‡å®šå¹³å°æ ‡è®°ä¸ºè¿‡æœŸï¼Œå¯ä»¥æŒ‡å®šç‰ˆæœ¬å·</p>
<p>obsoleted=ç‰ˆæœ¬å·ï¼šä»æŒ‡å®šå¹³å°æŸä¸ªç‰ˆæœ¬å¼€å§‹åºŸå¼ƒï¼ˆæ³¨æ„å¼ƒç”¨çš„åŒºåˆ«ï¼Œdeprecatedæ˜¯è¿˜å¯ä»¥ç»§ç»­ä½¿ç”¨ï¼Œåªä¸è¿‡æ˜¯ä¸æ¨èäº†ï¼Œobsoletedæ˜¯è°ƒç”¨å°±ä¼šç¼–è¯‘é”™è¯¯ï¼‰è¯¥å£°æ˜<br>
message=ä¿¡æ¯å†…å®¹ï¼šç»™å‡ºä¸€äº›é™„åŠ ä¿¡æ¯<br>
unavailableï¼šæŒ‡å®šå¹³å°ä¸Šæ˜¯æ— æ•ˆçš„<br>
renamed=æ–°åå­—ï¼šé‡å‘½åå£°æ˜<br>
å®ƒçš„å«ä¹‰æ˜¯é’ˆå¯¹swiftè¯­è¨€ï¼Œè¯¥æ–¹å¼åœ¨swift4.1ç‰ˆæœ¬ä¹‹åæ ‡è®°ä¸ºè¿‡æœŸï¼Œå¯¹åº”è¯¥å‡½æ•°çš„æ–°åå­—ä¸ºcompactMap(ğŸ˜ƒï¼Œå¦‚æœæˆ‘ä»¬åœ¨4.1ä¹‹ä¸Šçš„ç‰ˆæœ¬ä½¿ç”¨è¯¥å‡½æ•°ä¼šæ”¶åˆ°ç¼–è¯‘å™¨çš„è­¦å‘Šï¼Œå³âš ï¸Please use compactMap(ğŸ˜ƒ for the case where closure returns an optional valueã€‚<br>
åœ¨Realmåº“é‡Œï¼Œæœ‰ä¸€ä¸ªé”€æ¯NotificationTokençš„æ–¹æ³•ï¼Œè¢«æ ‡è®°ä¸ºunavailableï¼š</p>
<pre><code>extension RLMNotificationToken {
    @available(*, unavailable, renamed: &quot;invalidate()&quot;)
    @nonobjc public func stop() { fatalError() }
}
</code></pre>
<p>æ ‡è®°ä¸ºunavailableå°±ä¸ä¼šè¢«ç¼–è¯‘å™¨è”æƒ³åˆ°ã€‚è¿™ä¸ªä¸»è¦æ˜¯ä¸ºå‡çº§ç”¨æˆ·çš„è¿ç§»åšå‡†å¤‡ï¼Œä»å¯ç”¨stop()çš„ç‰ˆæœ¬å‡ä¸Šäº†ï¼Œä¼šçº¢è‰²æŠ¥é”™ï¼Œæç¤ºè¯¥æ–¹æ³•ä¸å¯ç”¨ã€‚å› ä¸ºæœ‰renamedï¼Œç¼–è¯‘å™¨ä¼šæ¨èä½ ç”¨invalidate()ï¼Œç‚¹å‡»fixå°±ç›´æ¥åˆ‡æ¢äº†ã€‚æ‰€ä»¥è¿™ä¸¤ä¸ªæ ‡è®°å‚æ•°å¸¸ä¸€èµ·å‡ºç°ã€‚</p>
<h3 id="discardableresult">@discardableResult</h3>
<p>å¸¦è¿”å›çš„å‡½æ•°å¦‚æœæ²¡æœ‰å¤„ç†è¿”å›å€¼ä¼šè¢«ç¼–è¯‘å™¨è­¦å‘Šâš ï¸ã€‚ä½†æœ‰æ—¶æˆ‘ä»¬å°±æ˜¯ä¸éœ€è¦è¿”å›å€¼çš„ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¯ä»¥è®©ç¼–è¯‘å™¨å¿½ç•¥è­¦å‘Šï¼Œå°±æ˜¯åœ¨æ–¹æ³•åå‰ç”¨@discardableResultå£°æ˜ä¸€ä¸‹ã€‚å¯ä»¥å‚è€ƒAlamofireä¸­requestçš„å†™æ³•ï¼š</p>
<pre><code>@discardableResult
public func request(
    _ url: URLConvertible,
    method: HTTPMethod = .get,
    parameters: Parameters? = nil,
    encoding: ParameterEncoding = URLEncoding.default,
    headers: HTTPHeaders? = nil)
    -&gt; DataRequest
{
    return SessionManager.default.request(
        url,
        method: method,
        parameters: parameters,
        encoding: encoding,
        headers: headers
    )
}
</code></pre>
<h3 id="inlinable">@inlinable</h3>
<p>è¿™ä¸ªå…³é”®è¯æ˜¯å¯å†…è”çš„å£°æ˜ï¼Œå®ƒæ¥æºäºCè¯­è¨€ä¸­çš„inlineã€‚Cä¸­ä¸€èˆ¬ç”¨äºå‡½æ•°å‰ï¼Œåšå†…è”å‡½æ•°ï¼Œå®ƒçš„ç›®çš„æ˜¯é˜²æ­¢å½“æŸä¸€å‡½æ•°å¤šæ¬¡è°ƒç”¨é€ æˆå‡½æ•°æ ˆæº¢å‡ºçš„æƒ…å†µã€‚å› ä¸ºå£°æ˜ä¸ºå†…è”å‡½æ•°ï¼Œä¼šåœ¨ç¼–è¯‘æ—¶å°†è¯¥æ®µå‡½æ•°è°ƒç”¨ç”¨å…·ä½“å®ç°ä»£æ›¿ï¼Œè¿™ä¹ˆåšå¯ä»¥çœå»å‡½æ•°è°ƒç”¨çš„æ—¶é—´ã€‚<br>
å†…è”å‡½æ•°å¸¸å‡ºç°åœ¨ç³»ç»Ÿåº“ä¸­ï¼ŒOCä¸­çš„runtimä¸­å°±æœ‰å¤§é‡çš„inlineä½¿ç”¨ï¼š</p>
<pre><code>static inline id autorelease(id obj)
{
    ASSERT(obj);
    ASSERT(!obj-&gt;isTaggedPointer());
    id *dest __unused = autoreleaseFast(obj);
    ASSERT(!dest  ||  dest == EMPTY_POOL_PLACEHOLDER  ||  *dest == obj);
    return obj;
}
</code></pre>
<p>Swiftä¸­çš„@inlinableå’ŒCä¸­çš„inlineåŸºæœ¬ç›¸åŒï¼Œå®ƒåœ¨æ ‡å‡†åº“çš„å®šä¹‰ä¸­ä¹Ÿå¹¿æ³›å‡ºç°ï¼Œå¯ç”¨äºæ–¹æ³•ï¼Œè®¡ç®—å±æ€§ï¼Œä¸‹æ ‡ï¼Œä¾¿åˆ©æ„é€ æ–¹æ³•æˆ–è€…deinitæ–¹æ³•ä¸­ã€‚<br>
ä¾‹å¦‚Swiftå¯¹Arrayä¸­mapå‡½æ•°çš„å®šä¹‰ï¼š<br>
@inlinable public func map<T>(_ transform: (Element) throws -&gt; T) rethrows -&gt; [T]<br>
å¤åˆ¶ä»£ç å…¶å®Arrayä¸­å£°æ˜çš„å¤§éƒ¨åˆ†å‡½æ•°å‰é¢éƒ½åŠ äº†@inlinableï¼Œå½“åº”ç”¨æŸä¸€å¤„è°ƒç”¨è¯¥æ–¹æ³•æ—¶ï¼Œç¼–è¯‘å™¨ä¼šå°†è°ƒç”¨å¤„ç”¨å…·ä½“å®ç°ä»£ç æ›¿æ¢ã€‚<br>
éœ€è¦æ³¨æ„å†…è”å£°æ˜ä¸èƒ½ç”¨äºæ ‡è®°ä¸ºprivateæˆ–è€…fileprivateçš„åœ°æ–¹ã€‚<br>
è¿™å¾ˆå¥½ç†è§£ï¼Œå¯¹ç§æœ‰æ–¹æ³•çš„å†…è”æ˜¯æ²¡æœ‰æ„ä¹‰çš„ã€‚å†…è”çš„å¥½å¤„æ˜¯è¿è¡Œæ—¶æ›´å¿«ï¼Œå› ä¸ºå®ƒçœç•¥äº†ä»æ ‡å‡†åº“è°ƒç”¨mapå®ç°çš„æ­¥éª¤ã€‚ä½†è¿™ä¸ªå¿«ä¹Ÿæ˜¯æœ‰ä»£ä»·çš„ï¼Œå› ä¸ºæ˜¯ç¼–è¯‘æ—¶åšæ›¿æ¢ï¼Œè¿™å¢åŠ äº†ç¼–è¯‘çš„å¼€é”€ï¼Œä¼šç›¸åº”çš„å»¶é•¿ç¼–è¯‘æ—¶é—´ã€‚<br>
å†…è”æ›´å¤šçš„æ˜¯ç”¨äºç³»ç»Ÿåº“çš„ç‰¹æ€§ï¼Œç›®å‰æˆ‘äº†è§£çš„Swiftä¸‰æ–¹åº“ä¸­ä»…æœ‰CocoaLumberjackä½¿ç”¨äº†@inlinableè¿™ä¸ªç‰¹æ€§</p>
<h3 id="warn_unqualified_access">@warn_unqualified_access</h3>
<p>é€šè¿‡å‘½åæˆ‘ä»¬å¯ä»¥æ¨æ–­å‡ºå…¶å¤§æ¦‚å«ä¹‰ï¼šå¯¹â€œä¸åˆè§„â€çš„è®¿é—®è¿›è¡Œè­¦å‘Šã€‚è¿™æ˜¯ä¸ºäº†è§£å†³å¯¹äºç›¸åŒåç§°çš„å‡½æ•°ï¼Œä¸åŒè®¿é—®å¯¹è±¡å¯èƒ½äº§ç”Ÿæ­§ä¹‰çš„é—®é¢˜ã€‚<br>
æ¯”å¦‚è¯´ï¼ŒSwift æ ‡å‡†åº“ä¸­Arrayå’ŒSequenceå‡å®ç°äº†min()æ–¹æ³•ï¼Œè€Œç³»ç»Ÿåº“ä¸­ä¹Ÿå®šä¹‰äº†min(:ğŸ˜ƒï¼Œå¯¹äºå¯èƒ½å­˜åœ¨çš„äºŒä¹‰æ€§é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥å€ŸåŠ©äº@warn_unqualified_accessã€‚<br>
è¿™ä¸ªç‰¹æ€§å£°æ˜ä¼šç”±ç¼–è¯‘å™¨åœ¨å¯èƒ½å­˜åœ¨äºŒä¹‰æ€§çš„åœºæ™¯ä¸­å¯¹æˆ‘ä»¬å‘å‡ºè­¦å‘Šã€‚è¿™é‡Œæœ‰ä¸€ä¸ªåœºæ™¯å¯ä»¥ä¾¿äºç†è§£å®ƒçš„å«ä¹‰ï¼Œæˆ‘ä»¬è‡ªå®šä¹‰ä¸€ä¸ªæ±‚Arrayä¸­æœ€å°å€¼çš„å‡½æ•°ï¼š</p>
<pre><code>extension Array where Element: Comparable {
    func minValue() -&gt; Element? {
        return min()
    }
}
</code></pre>
<p>æˆ‘ä»¬ä¼šæ”¶åˆ°ç¼–è¯‘å™¨çš„è­¦å‘Šï¼šUse of 'min' treated as a reference to instance method in protocol 'Sequence', Use 'self.' to silence this warningã€‚å®ƒå‘Šè¯‰æˆ‘ä»¬ç¼–è¯‘å™¨æ¨æ–­æˆ‘ä»¬å½“å‰ä½¿ç”¨çš„æ˜¯Sequenceä¸­çš„min()ï¼Œè¿™ä¸æˆ‘ä»¬çš„æƒ³æ³•æ˜¯è¿èƒŒçš„ã€‚å› ä¸ºæœ‰è¿™ä¸ª@warn_unqualified_accessé™å®šï¼Œæˆ‘ä»¬èƒ½åŠæ—¶çš„å‘ç°é—®é¢˜ï¼Œå¹¶è§£å†³é—®é¢˜ï¼šself.min()ã€‚</p>
<h3 id="objc-2">@objc</h3>
<p>æŠŠè¿™ä¸ªç‰¹æ€§ç”¨åˆ°ä»»ä½•å¯ä»¥åœ¨ Objective-C ä¸­è¡¨ç¤ºçš„å£°æ˜ä¸Šâ€”â€”ä¾‹å¦‚ï¼Œéå†…åµŒç±»ï¼Œåè®®ï¼Œéæ³›å‹æšä¸¾ï¼ˆåŸå§‹å€¼ç±»å‹åªèƒ½æ˜¯æ•´æ•°ï¼‰ï¼Œç±»å’Œåè®®çš„å±æ€§ã€æ–¹æ³•ï¼ˆåŒ…æ‹¬ setter å’Œ getter ï¼‰ï¼Œåˆå§‹åŒ–å™¨ï¼Œååˆå§‹åŒ–å™¨ï¼Œä¸‹æ ‡ã€‚ objc ç‰¹æ€§å‘Šè¯‰ç¼–è¯‘å™¨ï¼Œè¿™ä¸ªå£°æ˜åœ¨ Objective-C ä»£ç ä¸­æ˜¯å¯ç”¨çš„ã€‚</p>
<p>ç”¨ objc ç‰¹æ€§æ ‡è®°çš„ç±»å¿…é¡»ç»§æ‰¿è‡ªä¸€ä¸ª Objective-C ä¸­å®šä¹‰çš„ç±»ã€‚å¦‚æœä½ æŠŠ objc ç”¨åˆ°ç±»æˆ–åè®®ä¸­ï¼Œå®ƒä¼šéšå¼åœ°åº”ç”¨äºè¯¥ç±»æˆ–åè®®ä¸­ Objective-C å…¼å®¹çš„æˆå‘˜ä¸Šã€‚å¦‚æœä¸€ä¸ªç±»ç»§æ‰¿è‡ªå¦ä¸€ä¸ªå¸¦ objc ç‰¹æ€§æ ‡è®°æˆ– Objective-C ä¸­å®šä¹‰çš„ç±»ï¼Œç¼–è¯‘å™¨ä¹Ÿä¼šéšå¼åœ°ç»™è¿™ä¸ªç±»æ·»åŠ  objc ç‰¹æ€§ã€‚æ ‡è®°ä¸º objc ç‰¹æ€§çš„åè®®ä¸èƒ½ç»§æ‰¿è‡ªé objc ç‰¹æ€§çš„åè®®ã€‚</p>
<p>@objcè¿˜æœ‰ä¸€ä¸ªç”¨å¤„æ˜¯å½“ä½ æƒ³åœ¨OCçš„ä»£ç ä¸­æš´éœ²ä¸€ä¸ªä¸åŒçš„åå­—æ—¶ï¼Œå¯ä»¥ç”¨è¿™ä¸ªç‰¹æ€§ï¼Œå®ƒå¯ä»¥ç”¨äºç±»ï¼Œå‡½æ•°ï¼Œæšä¸¾ï¼Œæšä¸¾æˆå‘˜ï¼Œåè®®ï¼Œgetterï¼Œsetterç­‰ã€‚</p>
<pre><code>// å½“åœ¨OCä»£ç ä¸­è®¿é—®enabledçš„getteræ–¹æ³•æ—¶ï¼Œæ˜¯é€šè¿‡isEnabledclass ExampleClass: NSObject {

    @objc var enabled: Bool {

        @objc(isEnabled) get {

            // Return the appropriate value

        }

    }

}
</code></pre>
<p>è¿™ä¸€ç‰¹æ€§è¿˜å¯ä»¥ç”¨äºè§£å†³æ½œåœ¨çš„å‘½åå†²çªé—®é¢˜ï¼Œå› ä¸ºSwiftæœ‰å‘½åç©ºé—´ï¼Œå¸¸å¸¸ä¸å¸¦å‰ç¼€å£°æ˜ï¼Œè€ŒOCæ²¡æœ‰å‘½åç©ºé—´æ˜¯éœ€è¦å¸¦çš„ï¼Œå½“åœ¨OCä»£ç ä¸­å¼•ç”¨Swiftåº“ï¼Œä¸ºäº†é˜²æ­¢æ½œåœ¨çš„å‘½åå†²çªï¼Œå¯ä»¥é€‰æ‹©ä¸€ä¸ªå¸¦å‰ç¼€çš„åå­—ä¾›OCä»£ç ä½¿ç”¨ã€‚<br>
Chartsä½œä¸ºä¸€ä¸ªåœ¨OCå’ŒSwiftä¸­éƒ½å¾ˆå¸¸ç”¨çš„å›¾æ ‡åº“ï¼Œæ˜¯éœ€è¦è¾ƒå¥½çš„åŒæ—¶å…¼å®¹ä¸¤ç§è¯­è¨€çš„ä½¿ç”¨çš„ï¼Œæ‰€ä»¥ä¹Ÿå¯ä»¥çœ‹åˆ°é‡Œé¢æœ‰å¤§é‡é€šè¿‡@objcæ ‡è®°å¯¹OCè°ƒç”¨æ—¶çš„é‡å‘½åä»£ç ï¼š</p>
<pre><code>@objc(ChartAnimator)

open class Animator: NSObject { }

@objc(ChartComponentBase)

open class ComponentBase: NSObject { }
</code></pre>
<h3 id="objcmembers">@ObjcMembers</h3>
<p>å› ä¸ºSwiftä¸­å®šä¹‰çš„æ–¹æ³•é»˜è®¤æ˜¯ä¸èƒ½è¢«OCè°ƒç”¨çš„ï¼Œé™¤éæˆ‘ä»¬æ‰‹åŠ¨æ·»åŠ @objcæ ‡è¯†ã€‚ä½†å¦‚æœä¸€ä¸ªç±»çš„æ–¹æ³•å±æ€§è¾ƒå¤šï¼Œè¿™æ ·ä¼šå¾ˆéº»çƒ¦ï¼Œäºæ˜¯æœ‰äº†è¿™æ ·ä¸€ä¸ªæ ‡è¯†ç¬¦@objcMembersï¼Œå®ƒå¯ä»¥è®©æ•´ä¸ªç±»çš„å±æ€§æ–¹æ³•éƒ½éšå¼æ·»åŠ @objcï¼Œä¸å…‰å¦‚æ­¤å¯¹äºç±»çš„å­ç±»ã€æ‰©å±•ã€å­ç±»çš„æ‰©å±•éƒ½ä¹Ÿéšå¼çš„æ·»åŠ @objcï¼Œå½“ç„¶å¯¹äºOCä¸æ”¯æŒçš„ç±»å‹ï¼Œä»ç„¶æ— æ³•è¢«OCè°ƒç”¨ï¼š</p>
<pre><code>@objcMembersclass MyClass : NSObject {

  func foo() { }             // implicitly @objc

  func bar() -&gt; (Int, Int)   // not @objc, because tuple returns

      // aren't representable in Objective-C

}

extension MyClass {

  func baz() { }   // implicitly @objc

}

class MySubClass : MyClass {

  func wibble() { }   // implicitly @objc

}

extension MySubClass {

  func wobble() { }   // implicitly @objc

}
</code></pre>
<h3 id="testable">testable</h3>
<p>@testableæ˜¯ç”¨äºæµ‹è¯•æ¨¡å—è®¿é—®ä¸»targetçš„ä¸€ä¸ªå…³é”®è¯ã€‚<br>
å› ä¸ºæµ‹è¯•æ¨¡å—å’Œä¸»å·¥ç¨‹æ˜¯ä¸¤ä¸ªä¸åŒçš„targetï¼Œåœ¨swiftä¸­ï¼Œæ¯ä¸ªtargetä»£è¡¨ç€ä¸åŒçš„moduleï¼Œä¸åŒmoduleä¹‹é—´è®¿é—®ä»£ç éœ€è¦publicå’Œopençº§åˆ«çš„å…³é”®è¯æ”¯æ’‘ã€‚ä½†æ˜¯ä¸»å·¥ç¨‹å¹¶ä¸æ˜¯å¯¹å¤–æ¨¡å—ï¼Œä¸ºäº†æµ‹è¯•ä¿®æ”¹è®¿é—®æƒé™æ˜¯ä¸åº”è¯¥çš„ï¼Œæ‰€ä»¥æœ‰äº†@testableå…³é”®è¯ã€‚ä½¿ç”¨å¦‚ä¸‹ï¼š</p>
<pre><code>import XCTest@testable import Project

class ProjectTests: XCTestCase {

  /* code */

}
</code></pre>
<p>è¿™æ—¶æµ‹è¯•æ¨¡å—å°±å¯ä»¥è®¿é—®é‚£äº›æ ‡è®°ä¸ºinternalæˆ–è€…publicçº§åˆ«çš„ç±»å’Œæˆå‘˜äº†ã€‚</p>
<h3 id="frozen-å’Œunknown-default">@frozen å’Œ@unknown default</h3>
<p>frozenæ„ä¸ºå†»ç»“ï¼Œæ˜¯ä¸ºSwift5çš„ABIç¨³å®šå‡†å¤‡çš„ä¸€ä¸ªå­—æ®µï¼Œæ„å‘³å‘ç¼–è¯‘å™¨ä¿è¯ä¹‹åä¸ä¼šåšå‡ºæ”¹å˜ã€‚ä¸ºä»€ä¹ˆéœ€è¦è¿™ä¹ˆåšä»¥åŠè¿™ä¹ˆåšæœ‰ä»€ä¹ˆå¥½å¤„ï¼Œä»–ä»¬å’ŒABIç¨³å®šæ˜¯æ¯æ¯ç›¸å…³çš„ï¼Œå†…å®¹æœ‰ç‚¹å¤šå°±ä¸æ”¾è¿™é‡Œäº†ï¼Œä¹‹åä¼šå•ç‹¬å‡ºä¸€ç¯‡æ–‡ç« ä»‹ç»ï¼Œè¿™é‡Œåªä»‹ç»è¿™ä¸¤ä¸ªå­—æ®µçš„å«ä¹‰ã€‚</p>
<pre><code>@frozen public enum ComparisonResult : Int {

    case orderedAscending = -1

    case orderedSame = 0

    case orderedDescending = 1

}

@frozen public struct String {}

extension AVPlayerItem {

  public enum Status : Int {

    case unknown = 0

    case readyToPlay = 1

    case failed = 2

  }

}
</code></pre>
<p>ComparisonResultè¿™ä¸ªæšä¸¾å€¼è¢«æ ‡è®°ä¸º@frozenå³ä½¿ä¿è¯ä¹‹åè¯¥æšä¸¾å€¼ä¸ä¼šå†å˜ã€‚æ³¨æ„åˆ°Stringä½œä¸ºç»“æ„ä½“ä¹Ÿè¢«æ ‡è®°ä¸º@frozenï¼Œæ„ä¸ºStringç»“æ„ä½“çš„å±æ€§åŠå±æ€§é¡ºåºå°†ä¸å†å˜åŒ–ã€‚å…¶å®æˆ‘ä»¬å¸¸ç”¨çš„ç±»å‹åƒIntã€Floatã€Arrayã€Dictionaryã€Setç­‰éƒ½å·²è¢«â€œå†»ç»“â€ã€‚éœ€è¦è¯´æ˜çš„æ˜¯å†»ç»“ä»…é’ˆå¯¹structå’Œenumè¿™ç§å€¼ç±»å‹ï¼Œå› ä¸ºä»–ä»¬åœ¨ç¼–è¯‘å™¨å°±ç¡®å®šå¥½äº†å†…å­˜å¸ƒå±€ã€‚å¯¹äºclassç±»å‹ï¼Œä¸å­˜åœ¨æ˜¯å¦å†»ç»“çš„æ¦‚å¿µï¼Œå¯ä»¥æƒ³ä¸‹ä¸ºä»€ä¹ˆã€‚</p>
<p>å¯¹äºæ²¡æœ‰æ ‡è®°ä¸ºfrozençš„æšä¸¾AVPlayerItem.Statusï¼Œåˆ™è®¤ä¸ºè¯¥æšä¸¾å€¼åœ¨ä¹‹åçš„ç³»ç»Ÿç‰ˆæœ¬ä¸­å¯èƒ½å˜åŒ–ã€‚</p>
<p>å¯¹äºå¯èƒ½å˜åŒ–çš„æšä¸¾ï¼Œæˆ‘ä»¬åœ¨åˆ—å‡ºæ‰€æœ‰caseçš„æ—¶å€™è¿˜éœ€è¦åŠ ä¸Šå¯¹@unknown defaultçš„åˆ¤æ–­ï¼Œè¿™ä¸€æ­¥ä¼šæœ‰ç¼–è¯‘å™¨æ£€æŸ¥ï¼š</p>
<pre><code>switch currentItem.status {

    case .readyToPlay:

        /* code */

    case .failed:

        /* code */

    case .unknown:

        /* code */

    @unknown default:

        fatalError(&quot;not supported&quot;)

}
</code></pre>
<h2 id="swift-å‡ ä¸ªé‡è¦å…³é”®è¯">Swift å‡ ä¸ªé‡è¦å…³é”®è¯</h2>
<h3 id="lazy">lazy</h3>
<p>lazyæ˜¯æ‡’åŠ è½½çš„å…³é”®è¯ï¼Œå½“æˆ‘ä»¬ä»…éœ€è¦åœ¨ä½¿ç”¨æ—¶è¿›è¡Œåˆå§‹åŒ–æ“ä½œå°±å¯ä»¥é€‰ç”¨è¯¥å…³é”®è¯ã€‚ä¸¾ä¸ªä¾‹å­ï¼š</p>
<pre><code>class Avatar {

  lazy var smallImage: UIImage = self.largeImage.resizedTo(Avatar.defaultSmallSize)

  var largeImage: UIImage

  init(largeImage: UIImage) {

    self.largeImage = largeImage

  }

}
</code></pre>
<p>å¯¹äºsmallImageï¼Œæˆ‘ä»¬å£°æ˜äº†lazyï¼Œå¦‚æœæˆ‘ä»¬ä¸å»è°ƒç”¨å®ƒæ˜¯ä¸ä¼šèµ°åé¢çš„å›¾ç‰‡ç¼©æ”¾è®¡ç®—çš„ã€‚ä½†æ˜¯å¦‚æœæ²¡æœ‰lazyï¼Œå› ä¸ºæ˜¯åˆå§‹åŒ–æ–¹æ³•ï¼Œå®ƒä¼šç›´æ¥è®¡ç®—å‡ºsmallImageçš„å€¼ã€‚æ‰€ä»¥lazyå¾ˆå¥½çš„é¿å…çš„ä¸å¿…è¦çš„è®¡ç®—ã€‚</p>
<p>å¦ä¸€ä¸ªå¸¸ç”¨lazyçš„åœ°æ–¹æ˜¯å¯¹äºUIå±æ€§çš„å®šä¹‰ï¼š</p>
<pre><code>lazy var dayLabel: UILabel = {

    let label = UILabel()

   label.text = self.todayText()

    return label

}()
</code></pre>
<p>è¿™é‡Œä½¿ç”¨çš„æ˜¯ä¸€ä¸ªé—­åŒ…ï¼Œå½“è°ƒç”¨è¯¥å±æ€§æ—¶ï¼Œæ‰§è¡Œé—­åŒ…é‡Œé¢çš„å†…å®¹ï¼Œè¿”å›å…·ä½“çš„labelï¼Œå®Œæˆåˆå§‹åŒ–ã€‚</p>
<p>ä½¿ç”¨lazyä½ å¯èƒ½ä¼šå‘ç°å®ƒåªèƒ½é€šè¿‡varåˆå§‹è€Œä¸èƒ½é€šè¿‡letï¼Œè¿™æ˜¯ç”±lazy çš„å…·ä½“å®ç°ç»†èŠ‚å†³å®šçš„ï¼šå®ƒåœ¨æ²¡æœ‰å€¼çš„æƒ…å†µä¸‹ä»¥æŸç§æ–¹å¼è¢«åˆå§‹åŒ–ï¼Œç„¶ååœ¨è¢«è®¿é—®æ—¶æ”¹å˜è‡ªå·±çš„å€¼ï¼Œè¿™å°±è¦æ±‚è¯¥å±æ€§æ˜¯å¯å˜çš„ã€‚</p>
<h3 id="unowned-weak">unowned weak</h3>
<p>Swiftå¼€å‘è¿‡ç¨‹ä¸­æˆ‘ä»¬ä¼šç»å¸¸è·Ÿé—­åŒ…æ‰“äº¤é“ï¼Œè€Œç”¨åˆ°é—­åŒ…å°±ä¸å¯é¿å…çš„é‡åˆ°å¾ªç¯å¼•ç”¨é—®é¢˜ã€‚åœ¨Swiftå¤„ç†å¾ªç¯å¼•ç”¨å¯ä»¥ä½¿ç”¨unownedå’Œweakè¿™ä¸¤ä¸ªå…³é”®è¯ã€‚çœ‹ä¸‹é¢ä¸¤ä¸ªä¾‹å­ï¼š</p>
<pre><code>class Dog {

    var name: String

    init (name: String ) {

        self.name = name

    }

    deinit {

        print(&quot;\(name) is deinitialized&quot;)

    }

}

class Bone {

   // weak ä¿®é¥°è¯

    weak var owner: Dog?

    init(owner: Dog?) {

        self.owner = owner

    }

    deinit {

        print(&quot;bone is deinitialized&quot; )

    }

}

var lucky: Dog? = Dog(name: &quot;Lucky&quot;)var bone: Bone? = Bone(owner: lucky!)

lucky =  nil// Lucky is deinitialized
</code></pre>
<p>è¿™é‡ŒDogå’ŒBoneæ˜¯ç›¸äº’å¼•ç”¨çš„å…³ç³»ï¼Œå¦‚æœæ²¡æœ‰weak var owner: Dog?è¿™é‡Œçš„weakå£°æ˜ï¼Œå°†ä¸ä¼šæ‰“å°Lucky is deinitializedã€‚è¿˜æœ‰ä¸€ç§è§£å†³å¾ªç¯åº”ç”¨çš„æ–¹å¼æ˜¯æŠŠweakæ›¿æ¢ä¸ºunownedå…³é”®è¯ã€‚</p>
<p>weakç›¸å½“äºocé‡Œé¢çš„weakï¼Œå¼±å¼•ç”¨ï¼Œä¸ä¼šå¢åŠ å¾ªç¯è®¡æ•°ã€‚ä¸»ä½“å¯¹è±¡é‡Šæ”¾æ—¶è¢«weakä¿®é¥°çš„å±æ€§ä¹Ÿä¼šè¢«é‡Šæ”¾ï¼Œæ‰€ä»¥weakä¿®é¥°å¯¹è±¡å°±æ˜¯optionalã€‚</p>
<p>Â·unownedç›¸å½“äºocé‡Œé¢çš„unsafe_unretainedï¼Œå®ƒä¸ä¼šå¢åŠ å¼•ç”¨è®¡æ•°ï¼Œå³ä½¿å®ƒçš„å¼•ç”¨å¯¹è±¡é‡Šæ”¾äº†ï¼Œå®ƒä»ç„¶ä¼šä¿æŒå¯¹è¢«å·²ç»é‡Šæ”¾äº†çš„å¯¹è±¡çš„ä¸€ä¸ª &quot;æ— æ•ˆçš„&quot; å¼•ç”¨ï¼Œå®ƒä¸èƒ½æ˜¯ Optional å€¼ï¼Œä¹Ÿä¸ä¼šè¢«æŒ‡å‘nilã€‚å¦‚æœæ­¤æ—¶ä¸ºæ— æ•ˆå¼•ç”¨ï¼Œå†å»å°è¯•è®¿é—®å®ƒå°±ä¼šcrashã€‚</p>
<p>è¿™ä¸¤è€…è¿˜æœ‰ä¸€ä¸ªæ›´å¸¸ç”¨çš„åœ°æ–¹æ˜¯åœ¨é—­åŒ…é‡Œé¢ï¼š</p>
<pre><code>lazy var someClosure: () -&gt; Void = { [weak self] in
    // è¢«weakä¿®é¥°åselfä¸ºoptionalï¼Œè¿™é‡Œæ˜¯åˆ¤æ–­selféç©ºçš„æ“ä½œ                                
    guard let self = self else { retrun }
    self.doSomethings()
}
</code></pre>
<p>è¿™é‡Œå¦‚æœæ˜¯unownedä¿®é¥°selfçš„è¯ï¼Œå°±ä¸éœ€è¦ç”¨guardåšè§£åŒ…æ“ä½œäº†ã€‚ä½†æ˜¯æˆ‘ä»¬ä¸èƒ½ä¸ºäº†çœç•¥è§£åŒ…çš„æ“ä½œå°±ç”¨unownedï¼Œä¹Ÿä¸èƒ½ä¸ºäº†å®‰å…¨èµ·è§å…¨éƒ¨weakï¼Œå¼„æ¸…æ¥šä¸¤è€…çš„é€‚ç”¨åœºæ™¯éå¸¸é‡è¦ã€‚</p>
<h3 id="keypath">KeyPath</h3>
<p>KeyPathæ˜¯é”®å€¼è·¯å¾„ï¼Œæœ€å¼€å§‹æ˜¯ç”¨äºå¤„ç†KVCå’ŒKVOé—®é¢˜ï¼Œåæ¥åˆåšäº†æ›´å¹¿æ³›çš„æ‰©å±•ã€‚</p>
<pre><code>// KVCé—®é¢˜ï¼Œæ”¯æŒstructã€classstruct
 User {

    let name: String

    var age: Int

}

var user1 = User()

user1.name = &quot;ferry&quot;

user1.age = 18

 //ä½¿ç”¨KVCå–å€¼let path: KeyPath = \User.name

user1[keyPath: path] = &quot;zhang&quot;let name = user1[keyPath: path]print(name) //zhang

// KVOçš„å®ç°è¿˜æ˜¯ä»…é™äºç»§æ‰¿è‡ªNSObjectçš„ç±»å‹// playItemä¸ºAVPlayerItemå¯¹è±¡

playItem.observe(\.status, changeHandler: { (_, change) in

    /* code */    

})
</code></pre>
<p>è¿™ä¸ªKeyPathçš„å®šä¹‰æ˜¯è¿™æ ·çš„ï¼š</p>
<pre><code>public class AnyKeyPath : Hashable, _AppendKeyPath {}

/// A partially type-erased key path, from a concrete root type to any/// resulting value type.public class PartialKeyPath&lt;Root&gt; : AnyKeyPath {}

/// A key path from a specific root type to a specific resulting value type.public class KeyPath&lt;Root, Value&gt; : PartialKeyPath&lt;Root&gt; {}
</code></pre>
<p>å®šä¹‰ä¸€ä¸ªKeyPathéœ€è¦æŒ‡å®šä¸¤ä¸ªç±»å‹ï¼Œæ ¹ç±»å‹å’Œå¯¹åº”çš„ç»“æœç±»å‹ã€‚å¯¹åº”ä¸Šé¢ç¤ºä¾‹ä¸­çš„pathï¼š</p>
<pre><code>let path: KeyPath&lt;User, String&gt; = \User.name
</code></pre>
<p>æ ¹ç±»å‹å°±æ˜¯Userï¼Œç»“æœç±»å‹å°±æ˜¯Stringã€‚ä¹Ÿå¯ä»¥ä¸æŒ‡å®šï¼Œå› ä¸ºç¼–è¯‘å™¨å¯ä»¥ä»\User.nameæ¨æ–­å‡ºæ¥ã€‚é‚£ä¸ºä»€ä¹ˆå«æ ¹ç±»å‹çš„ï¼Ÿå¯ä»¥æ³¨æ„åˆ°KeyPathéµå¾ªä¸€ä¸ªåè®®_AppendKeyPathï¼Œå®ƒé‡Œé¢å®šä¹‰äº†å¾ˆå¤šappendçš„æ–¹æ³•ï¼ŒKeyPathæ˜¯å¤šå±‚å¯ä»¥è¿½åŠ çš„ï¼Œå°±æ˜¯å¦‚æœå±æ€§æ˜¯è‡ªå®šä¹‰çš„Addressç±»å‹ï¼Œå½¢å¦‚ï¼š</p>
<pre><code>struct Address {

    var country: String = &quot;&quot;

}let path: KeyPath&lt;User, String&gt; = \User.address.country

è¿™é‡Œæ ¹ç±»å‹ä¸ºUserï¼Œæ¬¡çº§ç±»å‹æ˜¯Addressï¼Œç»“æœç±»å‹æ˜¯Stringã€‚æ‰€ä»¥pathçš„ç±»å‹ä¾ç„¶æ˜¯KeyPath&lt;User, String&gt;ã€‚

æ˜ç™½äº†è¿™äº›æˆ‘ä»¬å¯ä»¥ç”¨KeyPathåšä¸€äº›æ‰©å±•ï¼š

extension Sequence {

    func sorted&lt;T: Comparable&gt;(by keyPath: KeyPath&lt;Element, T&gt;) -&gt; [Element] {

        return sorted { a, b in

            return a[keyPath: keyPath] &lt; b[keyPath: keyPath]

        }

    }

}// users is Array&lt;User&gt;let newUsers = users.sorted(by: \.age)
</code></pre>
<p>è¿™ä¸ªè‡ªå®šä¹‰sortedå‡½æ•°å®ç°äº†é€šè¿‡ä¼ å…¥keyPathè¿›è¡Œå‡åºæ’åˆ—åŠŸèƒ½ã€‚</p>
<h3 id="some">some</h3>
<p>someæ˜¯Swift5.1æ–°å¢çš„ç‰¹æ€§ã€‚å®ƒçš„ç”¨æ³•å°±æ˜¯ä¿®é¥°åœ¨ä¸€ä¸ª protocol å‰é¢ï¼Œé»˜è®¤åœºæ™¯ä¸‹ protocol æ˜¯æ²¡æœ‰å…·ä½“ç±»å‹ä¿¡æ¯çš„ï¼Œä½†æ˜¯ç”¨some ä¿®é¥°åï¼Œç¼–è¯‘å™¨ä¼šè®© protocol çš„å®ä¾‹ç±»å‹å¯¹å¤–é€æ˜ã€‚</p>
<p>å¯ä»¥é€šè¿‡ä¸€ä¸ªä¾‹å­ç†è§£è¿™æ®µè¯çš„å«ä¹‰ï¼Œå½“æˆ‘ä»¬å°è¯•å®šä¹‰ä¸€ä¸ªéµå¾ªEquatableåè®®çš„valueæ—¶ï¼š</p>
<pre><code>// Protocol 'Equatable' can only be used as a generic constraint because it has Self or associated type requirements
var value: Equatable {
    return 1
}

var value: Int {
    return 1
}
</code></pre>
<p>ç¼–è¯‘å™¨æç¤ºæˆ‘ä»¬Equatableåªèƒ½è¢«ç”¨æ¥åšæ³›å‹çš„çº¦æŸï¼Œå®ƒä¸æ˜¯ä¸€ä¸ªå…·ä½“çš„ç±»å‹ï¼Œè¿™é‡Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ä¸€ä¸ªéµå¾ªEquatableçš„å…·ä½“ç±»å‹ï¼ˆIntï¼‰è¿›è¡Œå®šä¹‰ã€‚ä½†æœ‰æ—¶æˆ‘ä»¬å¹¶ä¸æƒ³æŒ‡å®šå…·ä½“çš„ç±»å‹ï¼Œè¿™æ—¶å°±å¯ä»¥åœ¨åè®®åå‰åŠ ä¸Šsomeï¼Œè®©ç¼–è¯‘å™¨è‡ªå·±å»æ¨æ–­valueçš„ç±»å‹ï¼š</p>
<pre><code>var value: some Equatable {
    return 1
}
</code></pre>
<p>åœ¨SwiftUIé‡Œsomeéšå¤„å¯è§ï¼š</p>
<pre><code>struct ContentView: View {
    var body: some View {
        Text(&quot;Hello World&quot;)
    }
}
</code></pre>
<p>è¿™é‡Œä½¿ç”¨someå°±æ˜¯å› ä¸ºViewæ˜¯ä¸€ä¸ªåè®®ï¼Œè€Œä¸æ˜¯å…·ä½“ç±»å‹ã€‚</p>

              </div>
              <div class="toc-container">
                <ul class="markdownIt-TOC">
<li>
<ul>
<li><a href="#swiftui">SwiftUI</a>
<ul>
<li><a href="#state">@State</a></li>
<li><a href="#binding">@Binding</a></li>
<li><a href="#observedobject">@ObservedObject</a></li>
<li><a href="#stateobject">@StateObject</a></li>
<li><a href="#environmentobject">@EnvironmentObject</a></li>
<li><a href="#environment">@Environment</a></li>
<li><a href="#appstorage">@AppStorage</a></li>
</ul>
</li>
<li><a href="#objc">Objc</a></li>
<li><a href="#swift">Swift</a>
<ul>
<li><a href="#dynamicmemberlookup">@dynamicMemberLookup</a></li>
<li><a href="#available">@available</a></li>
<li><a href="#discardableresult">@discardableResult</a></li>
<li><a href="#inlinable">@inlinable</a></li>
<li><a href="#warn_unqualified_access">@warn_unqualified_access</a></li>
<li><a href="#objc-2">@objc</a></li>
<li><a href="#objcmembers">@ObjcMembers</a></li>
<li><a href="#testable">testable</a></li>
<li><a href="#frozen-%E5%92%8Cunknown-default">@frozen å’Œ@unknown default</a></li>
</ul>
</li>
<li><a href="#swift-%E5%87%A0%E4%B8%AA%E9%87%8D%E8%A6%81%E5%85%B3%E9%94%AE%E8%AF%8D">Swift å‡ ä¸ªé‡è¦å…³é”®è¯</a>
<ul>
<li><a href="#lazy">lazy</a></li>
<li><a href="#unowned-weak">unowned weak</a></li>
<li><a href="#keypath">KeyPath</a></li>
<li><a href="#some">some</a></li>
</ul>
</li>
</ul>
</li>
</ul>

              </div>
            </div>
          </article>
        </div>

        
          <div class="next-post">
            <div class="next">ä¸‹ä¸€ç¯‡</div>
            <a href="https://lijianfei.com/post/swift-structure-code-with-marktodofixme/">
              <h3 class="post-title">
                Swift Structure code with MARK/TODO/FIXME
              </h3>
            </a>
          </div>
        

        

        <div class="site-footer">
  Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a>
  <a class="rss" href="https://lijianfei.com/atom.xml" target="_blank">
    <i class="ri-rss-line"></i> RSS
  </a>
</div>

      </div>
    </div>

    <script>
      hljs.initHighlightingOnLoad()

      let mainNavLinks = document.querySelectorAll(".markdownIt-TOC a");

      // This should probably be throttled.
      // Especially because it triggers during smooth scrolling.
      // https://lodash.com/docs/4.17.10#throttle
      // You could do like...
      // window.addEventListener("scroll", () => {
      //    _.throttle(doThatStuff, 100);
      // });
      // Only not doing it here to keep this Pen dependency-free.

      window.addEventListener("scroll", event => {
        let fromTop = window.scrollY;

        mainNavLinks.forEach((link, index) => {
          let section = document.getElementById(decodeURI(link.hash).substring(1));
          let nextSection = null
          if (mainNavLinks[index + 1]) {
            nextSection = document.getElementById(decodeURI(mainNavLinks[index + 1].hash).substring(1));
          }
          if (section.offsetTop <= fromTop) {
            if (nextSection) {
              if (nextSection.offsetTop > fromTop) {
                link.classList.add("current");
              } else {
                link.classList.remove("current");    
              }
            } else {
              link.classList.add("current");
            }
          } else {
            link.classList.remove("current");
          }
        });
      });

    </script>
  </body>
</html>
